<project name="SRGP_data_website" default="dist" basedir=".">
  <description>
    Ant build script for SRGP Data Group
  </description>

  <property name="src"        value="src"/>
  <property name="build"      value="build"/>
  <property name="dist"       value="dist"/>
  <property name="html"       value="${src}/html"/>
  <property name="images"     value="${src}/images"/>
  <property name="jsp"        value="${src}/jsp"/>
  <property name="javascript" value="${src}/javascript"/>
  <property name="lib.dir"    value="lib"/>
  <property name="libs.api"   value="${lib.dir}/servlet-api.jar"/>

  <target name="buildinfo">
    <!-- Create the time stamp -->
    <tstamp>
      <format property="build.timestamp" pattern="dd-MMM-yyyy HH:mm:ss" />
    </tstamp>

    <propertyfile file="/SRGP/website/project.properties"
        comment="This file is automatically generated - DO NOT EDIT">        
	<entry key="buildNum" default="0" type="int" operation="+" value="1"/>
	<entry key="buildDate" value="${build.timestamp}"/>
    </propertyfile>
  </target>
	    
  <target name="clean" depends="buildinfo" description="clean up" >
    <!-- Delete the ${build} and ${dist} directory trees -->
    <delete dir="${build}"/>
    <delete dir="${dist}"/>
  </target>

  <target name="init" depends="clean">
    <!-- Create the build directory structure used by compile -->
    <mkdir dir="${build}"/>
    <mkdir dir="${build}/css"/>
    <mkdir dir="${build}/jsp"/>
    <mkdir dir="${build}/javascript"/>
    <mkdir dir="${build}/html"/>
    <mkdir dir="${build}/images"/>
    <mkdir dir="${build}/WEB-INF"/>
    <mkdir dir="${build}/WEB-INF/classes"/>
    <mkdir dir="${build}/WEB-INF/lib"/>
    <!-- Create the dist directory  -->
    <mkdir dir="${dist}"/>
  </target>

  <target name="compile" depends="init"
    description="compile the source " >
    <!-- Compile the java code from ${src} into ${build} -->
    <javac classpath="${libs.api}"
           srcdir="${src}"
           destdir="${build}/WEB-INF/classes"
	   debug="on"/>
  </target>

  <target name="dist" depends="compile"
    description="generate the distribution" >

    <copy todir="${build}/WEB-INF">
      <fileset dir=".">
        <include name="*.properties"/>
      </fileset>
    </copy>

    <copy todir="${build}/javascript">
      <fileset dir="${javascript}">
        <include name="*.js"/>
      </fileset>
    </copy>

    <copy todir="${build}/jsp">
      <fileset dir="${jsp}">
        <include name="*.jsp"/>
      </fileset>
    </copy>

    <copy todir="${build}/WEB-INF">
      <fileset dir="${src}/WEB-INF">
        <include name="web.xml"/>
      </fileset>
    </copy>

    <copy todir="${build}/WEB-INF/lib">
      <fileset dir="${lib.dir}">
        <include name="mysql-connector-java-5.0.7-bin.jar"/>
      </fileset>
    </copy>

    <copy todir="${build}/images">
      <fileset dir="${images}">
        <include name="*.png"/>
        <include name="*.jpg"/>
        <include name="*.gif"/>
        <include name="*.ico"/>
      </fileset>
    </copy>

    <copy todir="${build}/css">
      <fileset dir="${src}/css">
        <include name="*.css"/>
      </fileset>
    </copy>

    <copy todir="${build}/html">
      <fileset dir="${src}/html">
        <include name="*.*"/>
      </fileset>
    </copy>

    <jar jarfile="${dist}/SRGP.war" basedir="${build}"/>

    <copy todir="/java_apps/apache-tomcat-7.0.59/webapps">
      <fileset dir="${dist}/">
        <include name="*.war"/>
      </fileset>
    </copy>

     <exec executable="/bin/ksh">
        <arg value="-c" />
        <arg value="cat project.properties | grep buildNum" />
      </exec>

  </target>

</project>
